<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <span class="navbar-brand">
    Treasure
  </span>
  <div class="collapse navbar-collapse" id="navbarText">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item">
        <a class="nav-link" href="/home">Home</a>
      </li>
      <% if user_signed_in? %>
        <li class="nav-item">
          <a class="nav-link" href="/account">Edit account</a>
        </li>
      <%end%>
    </ul>
    <% if user_signed_in? %>
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <form class="button_to" method="post" action="/logout">
            <input type="hidden" name="_method" value="delete" autocomplete="off">
            <button class="btn btn-outline-light my-2 my-sm-0" type="submit">Logout</button>
          </form>
        </li>
      </ul>
    <%end%>
    <% unless user_signed_in? %>
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link" href="/login">Login</a>
        </li>
      </ul>
      <form class="button_to" method="get" action="/sign_up">
        <button class="btn btn-outline-light my-2 my-sm-0" type="submit">Sign Up</button>
      </form>
    <% end %>
  </div>
</nav>
<h3>Edit labyrinth</h3>
<% @width = "512" %>
<% @height = "512" %>

<div data-controller="edit">
  <canvas id="myCanvas" width=<%= @width %> height=<%= @height %>></canvas>
  <%= button_to 'Back', '/menu', method: :get %>
  <%= button_to 'Clear', '/edit_labyrinth', id: "clear", method: :get %>
  <button id='resetLab' onclick="get_lab()">Reset</button>
  <script>
      async function get_lab() {
          fetch('/reset_labyrinth')
              .then(response => response.json())
              .then(results => localStorage.setItem('field', JSON.stringify(results)));
      }
  </script>

  <button id='saveLab' onclick="save_lab()">Save</button>
  <script>
      async function save_lab() {
          let labyrinth = {
              field: localStorage.getItem('field')
          };

          const token = document.querySelector('meta[name="csrf-token"]').content;

          let response = await fetch('/save_labyrinth', {
              method: 'POST',
              headers: {
                  "X-CSRF-Token": token,
                  "Content-Type": "application/json"
              },
              body: JSON.stringify(labyrinth)
          });

          let result = await response.json();
          alert(result.message);
      }
  </script>
</div>
